QoDesk.DenunciasWindow=Ext.extend(Ext.app.Module,{id:"denuncias",type:"desktop/denuncias",init:function(){this.launcher={text:"Recepción documentos",iconCls:"denuncias-icon",handler:this.createWindow,scope:this}},createWindow:function(){var a=QoDesk.App.memberInfo.zonal,i=this.app.isAllowedTo("accesosAdministrador",this.id),e=this.app.isAllowedTo("accesosSecretaria",this.id),n=this.app.isAllowedTo("accesosZonales",this.id),t="",r=!!(i||e||n),o=this.app.getDesktop(),d=new Ext.AppMsg({}),s=o.getWindow("grid-win-denuncias"),l="modules/desktop/denuncias/server/";new Ext.form.TextField({allowBlank:!1});function c(e){return e?e.dateFormat("Y-m-d H:i:s"):""}storeTID=new Ext.data.JsonStore({root:"documento",fields:["id","nombre"],autoLoad:!0,data:{documento:[{id:2,nombre:"Comunicados"},{id:1,nombre:"Denuncias"},{id:3,nombre:"Oficio"},{id:4,nombre:"Memorando"},{id:5,nombre:"Escrito"}]}});var m=new Ext.form.ComboBox({id:"comboTID",store:storeTID,valueField:"id",displayField:"nombre",triggerAction:"all",mode:"local",forceSelection:!0,allowBlank:!1});function u(e){var t=storeTID.find("id",e);if(-1<t)return storeTID.getAt(t).get("nombre")}storeOFAC=new Ext.data.JsonStore({root:"users",fields:["id","nombre"],autoLoad:!0,data:{users:[{id:"true",nombre:"Si"},{id:"false",nombre:"No"},{id:"",nombre:"No"}]}});new Ext.form.ComboBox({id:"comboOFAC",store:storeOFAC,valueField:"id",displayField:"nombre",triggerAction:"all",mode:"local"});storeTIPPES=new Ext.data.JsonStore({root:"users",fields:["id","nombre"],autoLoad:!0,data:{users:[{id:"email",nombre:"Email"},{id:"oficio",nombre:"Oficiio"},{id:"memo",nombre:"Memo"}]}});new Ext.form.ComboBox({id:"comboOFAC",store:storeTIPPES,valueField:"id",displayField:"nombre",triggerAction:"all",mode:"local"});storeREA=new Ext.data.JsonStore({root:"data",fields:["id","nombre","orden"],autoLoad:!0,url:"modules/common/combos/combos.php?tipo=unidades",remoteSort:!0,sorters:[{property:"orden",direction:"ASC"}]}),storeREA.sort("orden","ASC");var p=new Ext.form.ComboBox({id:"comboREA",store:storeREA,valueField:"id",displayField:"nombre",mode:"local",forceSelection:!0,allowBlank:!1});function h(e){var t=storeREA.findExact("id",e);return-1<t?storeREA.getAt(t).get("nombre"):""}storeCONTROLPROGRAMADO=new Ext.data.JsonStore({root:"datos",fields:["id","nombre"],autoLoad:!0,data:{datos:[{id:8,nombre:"Denuncia"},{id:7,nombre:"CCF"},{id:6,nombre:"Operativos"},{id:5,nombre:"Construcciones"},{id:4,nombre:"Fauna Urbana"},{id:3,nombre:"Operativo"},{id:2,nombre:"Inspeccion"},{id:1,nombre:"Inspeccion conjunta"},{id:0,nombre:"Control programado"}]}});new Ext.form.ComboBox({id:"comboCONTROLPROGRAMADO",store:storeCONTROLPROGRAMADO,valueField:"id",displayField:"nombre",triggerAction:"all",mode:"local"});storeREATOT=new Ext.data.JsonStore({root:"data",fields:["id","nombre"],autoLoad:!0,url:"modules/common/combos/combos.php?tipo=unidadestotal"});new Ext.form.ComboBox({id:"comboREATOT",store:storeREATOT,valueField:"id",displayField:"nombre",triggerAction:"all",mode:"local"});storeREAGUIA=new Ext.data.JsonStore({root:"data",fields:["id","nombre"],autoLoad:!0,url:"modules/common/combos/combos.php?tipo=guia"});new Ext.form.ComboBox({id:"comboREAGUIA",store:storeREAGUIA,valueField:"id",displayField:"nombre",triggerAction:"all",mode:"local"});storeCDT=new Ext.data.JsonStore({root:"datos",fields:["id","nombre"],autoLoad:!0,data:{datos:[{id:1,nombre:"Ordinario"},{id:2,nombre:"Urgente"}]}});var b=new Ext.form.ComboBox({id:"comboCDT",store:storeCDT,valueField:"id",displayField:"nombre",triggerAction:"all",mode:"local"});function g(e){var t=storeCDT.find("id",e);if(-1<t){var o=storeCDT.getAt(t);return"Ordinario"==o.get("nombre")?'<span style="color:green;">'+o.get("nombre")+"</span>":'<span style="color:red;">'+o.get("nombre")+"</span>"}}storeZonal=new Ext.data.JsonStore({root:"data",fields:["id","nombre"],autoLoad:!0,url:"modules/common/combos/combos.php?tipo=zonas"});new Ext.form.ComboBox({id:"comboZonas",store:storeZonal,valueField:"id",displayField:"nombre",triggerAction:"all",mode:"local",forceSelection:!0,allowBlank:!1});function x(e){var t=storeZonal.findExact("id",e);if(-1<t)return storeZonal.getAt(t).get("nombre")}storeDETIORD=new Ext.data.JsonStore({root:"data",fields:["id","nombre"],autoLoad:!0,url:"modules/common/combos/combos.php?tipo=ordenanzas"});var f=new Ext.form.ComboBox({id:"comboDETIORD",store:storeDETIORD,valueField:"id",displayField:"nombre",triggerAction:"all",mode:"local",forceSelection:!0,allowBlank:!1});function w(e){var t=storeDETIORD.findExact("id",e);if(-1<t)return storeDETIORD.getAt(t).get("nombre")}storecrolProgramado=new Ext.data.JsonStore({root:"data",fields:["id","nombre"],autoLoad:!0,url:"modules/common/combos/combos.php?tipo=tipo_control"});var E=new Ext.form.ComboBox({id:"comboCROLPROGRAMADO",store:storecrolProgramado,valueField:"id",displayField:"nombre",triggerAction:"all",mode:"local",forceSelection:!0,allowBlank:!1});function y(e){var t=storecrolProgramado.findExact("id",e);if(-1<t)return storecrolProgramado.getAt(t).get("nombre")}storePRD=new Ext.data.JsonStore({root:"data",fields:["id","nombre"],autoLoad:!0,url:"modules/common/combos/combos.php?tipo=personalsecretaria"});new Ext.form.ComboBox({id:"comboPRD",store:storePRD,valueField:"id",displayField:"nombre",triggerAction:"all",mode:"local",allowBlank:!0});function _(e){var t=storePRD.findExact("id",e);if(-1<t)return'<span style="font-size: 10px!important">'+storePRD.getAt(t).get("nombre")+"</span>"}function D(e){return'<span style="font-size: 10px!important">'+e+"</span>"}storeINST=new Ext.data.JsonStore({root:"data",fields:["nombre"],autoLoad:!0,url:"modules/common/combos/combos.php?tipo=instituciones"});var A=new Ext.form.ComboBox({id:"comboINST",store:storeINST,valueField:"nombre",displayField:"nombre",triggerAction:"all",mode:"local",allowBlank:!1});storeREMI=new Ext.data.JsonStore({root:"data",fields:["nombre"],autoLoad:!0,url:"modules/common/combos/combos.php?tipo=remitente"});var R=new Ext.form.ComboBox({id:"comboREMI",store:storeREMI,valueField:"nombre",displayField:"nombre",triggerAction:"all",mode:"local",allowBlank:!1});storeZONA=new Ext.data.JsonStore({root:"data",fields:["id","nombre"],autoLoad:!0,url:"modules/common/combos/combos.php?tipo=zonas"});new Ext.form.ComboBox({id:"comboZONA",store:storeZONA,valueField:"id",displayField:"nombre",triggerAction:"all",mode:"local"});storeACTA=new Ext.data.JsonStore({root:"data",fields:["id","nombre"],autoLoad:!0,url:"modules/common/combos/combos.php?tipo=depInspeccion"});new Ext.form.ComboBox({id:"comboACTA",store:storeACTA,valueField:"id",displayField:"nombre",triggerAction:"all",mode:"local"});storeESREA=new Ext.data.JsonStore({root:"datos",fields:["id","nombre"],autoLoad:!0,data:{datos:[{id:0,nombre:"Sin información"},{id:1,nombre:"Conforme"},{id:2,nombre:"Inconforme"}]}});new Ext.form.ComboBox({id:"comboESREA",store:storeESREA,valueField:"id",displayField:"nombre",triggerAction:"all",mode:"local"});storePRSA=new Ext.data.JsonStore({root:"data",fields:["id","nombre"],autoLoad:!0,url:"modules/common/combos/combos.php?tipo=procedimiento"});new Ext.form.ComboBox({id:"comboPRSA",store:storePRSA,valueField:"id",displayField:"nombre",triggerAction:"all",mode:"local"});storePRASA=new Ext.data.JsonStore({root:"data",fields:["id","nombre"],autoLoad:!0,url:"modules/common/combos/combos.php?tipo=personalinspeccion"});new Ext.form.ComboBox({id:"comboPRASA",store:storePRASA,valueField:"id",displayField:"nombre",triggerAction:"all",mode:"local"});var F=new Ext.data.HttpProxy({api:{create:l+"crudDenunciasGuia.php?operation=insert",read:l+"crudDenunciasGuia.php?operation=select",update:l+"crudDenunciasGuia.php?operation=update",destroy:l+"crudDenunciasGuia.php?operation=delete"}}),v=new Ext.data.JsonReader({successProperty:"success",messageProperty:"message",idProperty:"id",root:"data",fields:[{name:"id",allowBlank:!1},{name:"numero",allowBlank:!1},{name:"unidad",allowBlank:!1},{name:"id_member",allowBlank:!1},{name:"creado",allowBlank:!1}]}),S=new Ext.data.JsonWriter({encode:!0,writeAllFields:!0});this.storeDenunciasGuia=new Ext.data.Store({id:"id",proxy:F,reader:v,writer:S,autoSave:!0}),this.storeDenunciasGuia.load(),this.gridDenunciasGuia=new Ext.grid.EditorGridPanel({id:"gridDenunciasGuia",xtype:"grid",height:200,store:this.storeDenunciasGuia,columns:[new Ext.grid.RowNumberer,{header:"id",dataIndex:"id",sortable:!0,width:5},{header:"Número",dataIndex:"numero",sortable:!0,width:30},{header:"Unidad Enviada",dataIndex:"unidad",sortable:!0,width:40},{header:"Fecha",dataIndex:"creado",sortable:!0,width:30},{header:"Encargado",dataIndex:"id_member",sortable:!0,width:40}],viewConfig:{forceFit:!0},sm:new Ext.grid.RowSelectionModel({singleSelect:!1,listeners:{rowselect:function(e,t,o){storeDenunciasSimple.load({params:{filterField:"guia",filterText:o.get("id")}})}}}),border:!1,stripeRows:!0,bbar:new Ext.PagingToolbar({pageSize:100,store:this.storeDenunciasGuia,displayInfo:!0,displayMsg:"Mostrando denuncias {0} - {1} of {2}",emptyMsg:"No existen denuncias que mostrar"})});var C=new Ext.data.HttpProxy({api:{create:l+"crudDenuncias.php?operation=insert",read:l+"crudDenuncias.php?operation=select",update:l+"crudDenuncias.php?operation=update",destroy:l+"crudDenuncias.php?operation=delete"},listeners:{write:function(e,t,o,a,i){void 0!==a.message&&(a.message,d.setAlert(d.STATUS_NOTICE,a.message))},exception:function(e,t,o){"update"==o&&d.setAlert("Requisito obligatorio","Faltan datos, cédula, email o tipo"),"create"==o&&d.setAlert("Requisito obligatorio","Faltan datos, cédula, email o tipo")}}}),k=new Ext.data.JsonReader({totalProperty:"total",successProperty:"success",messageProperty:"message",idProperty:"id",root:"data",fields:[{name:"codigo_tramite",allowBlank:!1},{name:"id_persona",allowBlank:!1},{name:"recepcion_documento",type:"date",dateFormat:"c",allowBlank:!1},{name:"id_tipo_documento",allowBlank:!1},{name:"id_ordenanza",allowBlank:!0},{name:"id_tipo",allowBlank:!0},{name:"cedula",allowBlank:!0},{name:"email",allowBlank:!0},{name:"num_documento",allowBlank:!1},{name:"remitente",allowBlank:!1},{name:"asunto",allowBlank:!1},{name:"institucion",allowBlank:!0},{name:"descripcion_anexos",allowBlank:!1},{name:"gdoc",allowBlank:!0},{name:"expediente",allowBlank:!0},{name:"reasignacion",allowBlank:!1},{name:"id_caracter_tramite",allowBlank:!1},{name:"cantidad_fojas",allowBlank:!1},{name:"id_zonal_origen",allowBlank:!0},{name:"despacho_secretaria",type:"boolean",allowBlank:!1}]}),I=new Ext.data.JsonWriter({encode:!0,writeAllFields:!0});if(this.storeDenuncias=new Ext.data.Store({id:"id",proxy:C,reader:k,writer:I,autoSave:r,remoteSort:!0,baseParams:{}}),storeDenuncias=this.storeDenuncias,limitedenuncias=100,storeDenuncias.baseParams={limit:limitedenuncias},this.gridDenuncias=new Ext.grid.EditorGridPanel({height:200,store:this.storeDenuncias,columns:[new Ext.grid.RowNumberer,{header:"Trámite",dataIndex:"codigo_tramite",sortable:!0,width:40},{header:"Persona recepta",dataIndex:"id_persona",sortable:!0,width:80,renderer:_},{header:"Recepción documento",dataIndex:"recepcion_documento",sortable:!0,width:115,renderer:c,editor:new Ext.ux.form.DateTimeField({dateFormat:"Y-m-d",timeFormat:"H:i:s"})},{header:"Tipo documento",dataIndex:"id_tipo_documento",sortable:!0,width:70,editor:m,renderer:u},{header:"Cédula",dataIndex:"cedula",sortable:!0,width:70,editor:new Ext.form.TextField({allowBlank:!1})},{header:"Email",dataIndex:"email",sortable:!0,width:120,editor:{xtype:"textfield",vtype:"email",allowBlank:!0}},{header:"Motivo",dataIndex:"id_tipo",sortable:!0,width:75,editor:E,renderer:y},{header:"Ordenanza",dataIndex:"id_ordenanza",sortable:!0,width:75,editor:f,renderer:w},{header:"N. documento",dataIndex:"num_documento",sortable:!0,width:80,editor:new Ext.form.TextField({allowBlank:!1}),renderer:D},{header:"Remitente/denunciante",dataIndex:"remitente",sortable:!0,width:100,editor:R,renderer:function(e){return e}},{header:"Institución",dataIndex:"institucion",sortable:!0,width:100,editor:A,renderer:function(e){return e},cls:"expand-panel"},{header:"Asunto",dataIndex:"asunto",sortable:!0,width:120,editor:new Ext.form.TextField({allowBlank:!1}),renderer:D},{header:"Desc. anexos",dataIndex:"descripcion_anexos",sortable:!0,width:100,editor:new Ext.form.TextField({allowBlank:!1}),renderer:D},{header:"GDoc",dataIndex:"gdoc",sortable:!0,width:100,editor:new Ext.form.TextField({allowBlank:!1}),renderer:D},{header:"Expediente",dataIndex:"expediente",sortable:!0,width:100,editor:new Ext.form.TextField({allowBlank:!1}),renderer:D},{header:"Fojas",dataIndex:"cantidad_fojas",align:"center",width:40,editor:new Ext.ux.form.SpinnerField({fieldLabel:"Age",name:"age",minValue:0,maxValue:1e3})},{header:"Reasignación",dataIndex:"reasignacion",sortable:!0,width:120,editor:p,renderer:h},{header:"Caracter",dataIndex:"id_caracter_tramite",sortable:!0,width:50,editor:b,renderer:g},{header:"Zonal",dataIndex:"id_zonal_origen",align:"center",width:70,renderer:x},{header:"Despachado",dataIndex:"despacho_secretaria",align:"center",falseText:"No",menuDisabled:!0,trueText:"Si",sortable:!0,width:35,xtype:"booleancolumn",hidden:!0}],viewConfig:{forceFit:!1,getRowClass:function(e,t){if(0==e.get("despacho_secretaria"))return"gold"}},sm:new Ext.grid.RowSelectionModel({singleSelect:!0,listeners:{rowselect:function(e,t,o){G(o.id,this.formDenunciasDetalle,o.get("despacho_secretaria")),r&&(o.get("despacho_secretaria")?Ext.getCmp("tb_grabardenuncias").setDisabled(!0):Ext.getCmp("tb_grabardenuncias").setDisabled(!1),o.get("id_zonal_origen")!=a?Ext.getCmp("tb_grabardenuncias").setDisabled(!0):Ext.getCmp("tb_grabardenuncias").setDisabled(!1)),storeINST.load()}}}),border:!1,stripeRows:!0,bbar:new Ext.PagingToolbar({pageSize:limitedenuncias,store:storeDenuncias,displayInfo:!0,displayMsg:"Mostrando trámites  {0} - {1} of {2}",emptyMsg:"No existen trámites que mostrar"}),listeners:{beforeedit:function(e){return!!r&&(!e.record.get("despacho_secretaria")&&e.record.get("id_zonal_origen")==a)},afteredit:function(e){G(e.record.i,this.formDenunciaswebDetalle,!1)}}}),this.storeDenunciasSimple=new Ext.data.Store({id:"id",proxy:C,reader:k,writer:I,autoSave:r,remoteSort:!0}),storeDenunciasSimple=this.storeDenunciasSimple,this.gridDenunciasSimple=new Ext.grid.EditorGridPanel({autoHeight:!0,autoScroll:!0,store:this.storeDenunciasSimple,columns:[new Ext.grid.RowNumberer,{header:"Trámite",dataIndex:"codigo_tramite",sortable:!0,width:15},{header:"Persona recepta",dataIndex:"id_persona",sortable:!0,width:35,renderer:_},{header:"Recepción documento",dataIndex:"recepcion_documento",sortable:!0,width:45,renderer:c},{header:"Tipo documento",dataIndex:"id_tipo_documento",sortable:!0,width:30,renderer:u},{header:"N. documento",dataIndex:"num_documento",sortable:!0,width:40},{header:"Remitente/denunciante",dataIndex:"remitente",sortable:!0,width:60},{header:"Asunto",dataIndex:"asunto",sortable:!0,width:55},{header:"Desc. anexos",dataIndex:"descripcion_anexos",sortable:!0,width:55},{header:"GDoc",dataIndex:"gdoc",sortable:!0,width:55},{header:"Expediente",dataIndex:"expediente",sortable:!0,width:55},{header:"Caracter trámite",dataIndex:"id_caracter_tramite",sortable:!0,width:30,renderer:g},{header:"Fojas",dataIndex:"cantidad_fojas",sortable:!0,width:20},{header:"Reasignación",dataIndex:"reasignacion",sortable:!0,width:60,renderer:h},{header:"Zonal",dataIndex:"id_zonal_origen",sortable:!0,width:30,renderer:x},{header:"Despachado",dataIndex:"despacho_secretaria",align:"center",falseText:"No",menuDisabled:!0,trueText:"Si",sortable:!0,width:20,xtype:"booleancolumn"}],viewConfig:{forceFit:!0},sm:new Ext.grid.RowSelectionModel({singleSelect:!0}),border:!1,stripeRows:!0,listeners:{beforeedit:function(e){return!!r&&!e.record.get("despacho_secretaria")}}}),this.storeDocumentosReporte=new Ext.data.Store({id:"id",proxy:C,reader:k,writer:I,autoSave:r,remoteSort:!0}),storeDocumentosReporte=this.storeDocumentosReporte,this.gridDocumentosReporte=new Ext.grid.EditorGridPanel({height:o.getWinHeight()-238,autoScroll:!0,store:this.storeDocumentosReporte,columns:[new Ext.grid.RowNumberer,{header:"Trámite",dataIndex:"codigo_tramite",sortable:!0,width:15},{header:"Persona recepta",dataIndex:"id_persona",sortable:!0,width:35,renderer:_},{header:"Recepción documento",dataIndex:"recepcion_documento",sortable:!0,width:45,renderer:c},{header:"Tipo documento",dataIndex:"id_tipo_documento",sortable:!0,width:30,renderer:u},{header:"Ordenanza",dataIndex:"id_ordenanza",sortable:!0,width:28,renderer:w},{header:"Tipo",dataIndex:"id_tipo",sortable:!0,width:28,renderer:y},{header:"N. documento",dataIndex:"num_documento",sortable:!0,width:40},{header:"Remitente/ Denunciante",dataIndex:"remitente",sortable:!0,width:60},{header:"Institución",dataIndex:"institucion",sortable:!0,width:60},{header:"Asunto",dataIndex:"asunto",sortable:!0,width:55},{header:"Desc. anexos",dataIndex:"descripcion_anexos",sortable:!0,width:55},{header:"GDoc",dataIndex:"gdoc",sortable:!0,width:55},{header:"Expediente",dataIndex:"expediente",sortable:!0,width:55},{header:"Caracter trámite",dataIndex:"id_caracter_tramite",sortable:!0,width:30,renderer:g},{header:"Fojas",dataIndex:"cantidad_fojas",sortable:!0,width:20},{header:"Reasignación",dataIndex:"reasignacion",sortable:!0,width:60,renderer:h},{header:"Zonal",dataIndex:"id_zonal_origen",sortable:!0,width:30,renderer:x},{header:"Despachado",dataIndex:"despacho_secretaria",align:"center",falseText:"No",menuDisabled:!0,trueText:"Si",sortable:!0,width:20,xtype:"booleancolumn"}],viewConfig:{forceFit:!0},sm:new Ext.grid.RowSelectionModel({singleSelect:!0}),border:!1,stripeRows:!0,bbar:new Ext.PagingToolbar({pageSize:100,store:this.storeDocumentosReporte,displayInfo:!0,displayMsg:"Mostrando guías {0} - {1} of {2}",emptyMsg:"No existen guías que mostrar"})}),!(s=o.getWindow("layout-win"))){var T=o.getWinWidth(),O=o.getWinHeight();this.seleccionDepar=3,this.formDenunciasDetalle=new Ext.FormPanel({id:"formDenunciasDetalle",cls:"no-border",items:[{id:"formcabeceradenuncias",items:this.gridDenuncias,titleCollapse:!0,split:!0,flex:1,autoScroll:!0,layout:"column"},{split:!0,flex:2,bodyStyle:"padding:0; background: #DFE8F6",layout:"column",items:[{xtype:"tabpanel",activeTab:0,width:T-14,cls:"no-border",items:[{title:"Secretaría",layout:"column",height:O-321,width:T-14,autoScroll:!0,tbar:[{text:"Grabar Recepción Detalle",scope:this,handler:this.grabardenuncias,iconCls:"save-icon",disabled:!0,id:"tb_grabardenuncias",formBind:!0},"->",{text:"Denuncias anteriores:",xtype:"tbtext",id:"textRecepcionAnteriores"}],items:[{columnWidth:1/3,layout:"form",monitorValid:!0,defaultType:"textfield",items:[{xtype:"hidden",fieldLabel:"Id",name:"id"},{fieldLabel:"Trámite",name:"codigo_tramite",anchor:"95%",readOnly:!0,cls:"sololectura"},{xtype:"combo",fieldLabel:"Persona recepta",name:"id_persona",id:"id_persona",anchor:"95%",hiddenName:"id_persona",readOnly:!0,store:storePRD,valueField:"id",displayField:"nombre",typeAhead:!0,triggerAction:"all",mode:"local"},{xtype:"datetimefield",fieldLabel:"Fecha recepción",id:"recepcion_documento",name:"recepcion_documento",anchor:"95%",readOnly:!1,dateFormat:"Y-m-d",timeFormat:"H:i:s"},{xtype:"combo",fieldLabel:"Tipo documento",id:"id_tipo_documento",name:"id_tipo_documento",anchor:"95%",hiddenName:"id_tipo_documento",store:storeTID,valueField:"id",displayField:"nombre",typeAhead:!0,triggerAction:"all",mode:"local"},{fieldLabel:"Núm documento",id:"num_documento",name:"num_documento",anchor:"95%"},{fieldLabel:"Remitente/ Denunciante",id:"remitente",name:"remitente",anchor:"95%"},{fieldLabel:"CI denunciante",id:"cedula",name:"cedula",allowBlank:!0,anchor:"95%"},{fieldLabel:"Email denunciante",id:"email",name:"email",anchor:"95%",allowBlank:!0,vtype:"email"},{fieldLabel:"Dirección denuncia",id:"direccion_denuncia",name:"direccion_denuncia",anchor:"95%"},{fieldLabel:"Georeferencia",id:"georeferenciaSecretaria",name:"georeferencia",anchor:"95%",allowBlank:!0,handleMouseEvents:!0,readOnly:!0,listeners:{render:function(e){e.getEl().on("click",function(){Ext.getCmp("panelPrincipal").setActiveTab(3)},e)}}}]},{columnWidth:1/3,layout:"form",items:[{xtype:"combo",fieldLabel:"Ordenanza",id:"id_ordenanza",name:"id_ordenanza",anchor:"95%",hiddenName:"id_ordenanza",store:storeDETIORD,valueField:"id",displayField:"nombre",typeAhead:!0,triggerAction:"all",mode:"local"},{xtype:"textfield",fieldLabel:"Descripción anexo",id:"descripcion_anexos",name:"descripcion_anexos",anchor:"95%"},{xtype:"textfield",fieldLabel:"Gdoc",id:"gdoc",name:"gdoc",anchor:"95%"},{xtype:"textfield",fieldLabel:"Expediente",id:"expediente",name:"expediente",anchor:"95%"},{xtype:"spinnerfield",fieldLabel:"Cantidad de fojas",id:"cantidad_fojas",name:"cantidad_fojas",minValue:0,maxValue:200,anchor:"95%"},{xtype:"textarea",fieldLabel:"Asunto",id:"asunto",name:"asunto",height:45,anchor:"95%"},{xtype:"textfield",fieldLabel:"Institución",id:"institucion",name:"institucion",anchor:"95%"},{xtype:"combo",fieldLabel:"Caracter del trámite",id:"id_caracter_tramite",name:"id_caracter_tramite",anchor:"95%",hiddenName:"id_caracter_tramite",store:storeCDT,valueField:"id",displayField:"nombre",typeAhead:!0,triggerAction:"all",mode:"local"},{xtype:"textarea",fieldLabel:"Observaciones secretaria",id:"observacion_secretaria",name:"observacion_secretaria",height:45,anchor:"95%"},{xtype:"displayfield",fieldLabel:"Total documentos anteriores:",name:"totaldocumentos",anchor:"95%"}]},{columnWidth:1/3,layout:"form",defaults:{listeners:{change:function(e,t,o){"despacho_secretaria"==e.getName()&&"true"==o&&"false"==t&&(Ext.getCmp("tb_grabardenuncias").setDisabled(!1),Ext.getCmp("reasignacion").enable()),"guia"==e.getName()&&o!=t&&Ext.getCmp("tb_grabardenuncias").setDisabled(!1)}}},items:[{xtype:"multiselect",fieldLabel:"Reasignado a:<br />(Para seleccion<br /> multiple mantenga<br /> pulsada la tecla Ctrl)",id:"reasignacion",name:"reasignacion",width:300,height:130,allowBlank:!1,store:storeREA,hiddenName:"reasignacion",displayField:"nombre",valueField:"id",ddReorder:!0},{xtype:"combo",fieldLabel:"Guía",name:"guia",id:"guia",anchor:"95%",hiddenName:"guia",store:storeREAGUIA,valueField:"id",displayField:"nombre",typeAhead:!0,triggerAction:"all",mode:"local"},{xtype:"combo",fieldLabel:"Despachado",name:"despacho_secretaria",id:"despacho_secretaria",anchor:"95%",hiddenName:"despacho_secretaria",store:storeOFAC,valueField:"id",displayField:"nombre",typeAhead:!0,triggerAction:"all",mode:"local"},{xtype:"combo",fieldLabel:"Tipo respuesta",name:"tipo_respuesta_devolucion",id:"tipo_respuesta_devolucion",anchor:"95%",hiddenName:"tipo_respuesta_devolucion",store:storeTIPPES,valueField:"id",displayField:"nombre",typeAhead:!0,triggerAction:"all",mode:"local"},{xtype:"textarea",fieldLabel:"Respuesta devolución",id:"respuesta_devolucion",name:"respuesta_devolucion",height:45,anchor:"95%"},{xtype:"displayfield",fieldLabel:"Fecha respuesta devolución",name:"fecha_respuesta_devolucion",anchor:"95%"}]}]},{title:"Inspección",layout:"column",autoScroll:!0,items:[{type:"container",columnWidth:.5,layout:"form",items:[{bodyStyle:"padding:0; background: #ebfaeb",xtype:"combo",fieldLabel:"Estado Recepcion Información",name:"estado_recepcion_informacion",anchor:"95%",hiddenName:"estado_recepcion_informacion",store:storeESREA,valueField:"id",displayField:"nombre",typeAhead:!0,triggerAction:"all",mode:"local",readOnly:!0,cls:"sololectura"},{xtype:"combo",fieldLabel:"Actividad",name:"actividad",anchor:"95%",hiddenName:"actividad",store:storeACTA,valueField:"id",displayField:"nombre",typeAhead:!0,triggerAction:"all",mode:"local",readOnly:!0,cls:"sololectura"},{xtype:"combo",fieldLabel:"Persona asignada",name:"persona_asignada",anchor:"95%",hiddenName:"persona_asignada",store:storePRASA,valueField:"id",displayField:"nombre",typeAhead:!0,triggerAction:"all",mode:"local",readOnly:!0,cls:"sololectura"},{xtype:"textfield",fieldLabel:"Cod inspección",name:"codigo_inspeccion",anchor:"95%",readOnly:!0,cls:"sololectura"}]},{type:"container",columnWidth:.5,layout:"form",items:[{xtype:"textfield",fieldLabel:"Cod procedimiento",name:"codigo_procedimiento",anchor:"95%",readOnly:!0,cls:"sololectura"},{xtype:"combo",fieldLabel:"Zona",name:"id_zona",anchor:"95%",hiddenName:"id_zona",store:storeZONA,valueField:"id",displayField:"nombre",typeAhead:!0,triggerAction:"all",mode:"local",readOnly:!0,cls:"sololectura"},{xtype:"textfield",fieldLabel:"Predio",name:"predio",anchor:"95%",readOnly:!0,cls:"sololectura"},{xtype:"textfield",fieldLabel:"Observación",name:"observacion",anchor:"95%",readOnly:!0,cls:"sololectura"},{xtype:"textarea",fieldLabel:"Procedimiento",name:"procedimientosdetalle",anchor:"95%",readOnly:!0,cls:"sololectura"}]}]}]}]}],defaults:{}}),this.formConsultaDocumentos=new Ext.FormPanel({layout:"column",title:"Ingrese los parámetros",frame:!0,bodyStyle:"padding:5px 5px 0",items:[{columnWidth:1/3,layout:"form",items:[{xtype:"datetimefield",fieldLabel:"Fecha Inicio",id:"busqueda_fecha_inicio",anchor:"95%",dateFormat:"Y-m-d",timeFormat:"H:i:s"},{xtype:"datetimefield",fieldLabel:"Fecha Fin",id:"busqueda_fecha_fin",anchor:"95%",dateFormat:"Y-m-d",timeFormat:"H:i:s"},{xtype:"combo",fieldLabel:"Tipo documento",id:"busqueda_tipo_documento",name:"busqueda_tipo_documento",hiddenName:"busqueda_tipo_documento",anchor:"95%",store:storeTID,valueField:"id",displayField:"nombre",typeAhead:!0,triggerAction:"all",mode:"local"},{xtype:"combo",fieldLabel:"Zonal Origen",id:"busqueda_id_zonal",name:"busqueda_id_zonal",hiddenName:"busqueda_id_zonal",anchor:"95%",store:storeZonal,valueField:"id",displayField:"nombre",typeAhead:!0,triggerAction:"all",mode:"local"}]},{columnWidth:1/3,layout:"form",items:[{xtype:"combo",fieldLabel:"Institución",id:"busqueda_institucion",name:"busqueda_institucion",hiddenName:"busqueda_institucion",anchor:"95%",store:storeINST,valueField:"nombre",displayField:"nombre",typeAhead:!0,triggerAction:"all",mode:"local"},{xtype:"combo",fieldLabel:"Caracter",id:"busqueda_caracter_tramite",name:"busqueda_caracter_tramite",anchor:"95%",hiddenName:"busqueda_caracter_tramite",store:storeCDT,valueField:"id",displayField:"nombre",typeAhead:!0,triggerAction:"all",mode:"local"},{xtype:"combo",fieldLabel:"Guía",name:"busqueda_guia",id:"busqueda_guia",anchor:"95%",hiddenName:"busqueda_guia",store:storeREAGUIA,valueField:"id",displayField:"nombre",typeAhead:!0,triggerAction:"all",mode:"local"},{xtype:"textfield",fieldLabel:"Palabra clave",id:"busqueda_palabra",name:"busqueda_palabra",anchor:"95%"}]},{columnWidth:1/3,layout:"form",items:[{xtype:"multiselect",fieldLabel:"Unidades",id:"busqueda_reasignacion",name:"busqueda_reasignacion",width:300,height:100,allowBlank:!1,store:storeREA,hiddenName:"busqueda_reasignacion",displayField:"nombre",valueField:"id",ddReorder:!0}]}]});function N(e,t){t&&(this.storeDenuncias.baseParams.filterField=e.key,L.setText(e.text))}function B(e,t){t&&(this.seleccionDepar=e.key,this.targetFieldBtn.setText(e.text))}var L=new Ext.Button({menu:new Ext.menu.Menu({items:[{checked:!0,checkHandler:N,group:"filterField",key:"codigo_tramite",scope:this,text:"Trámite"},{checked:!1,checkHandler:N,group:"filterField",key:"num_documento",scope:this,text:"Número documento"},{checked:!1,checkHandler:N,group:"filterField",key:"remitente",scope:this,text:"Remitente/ Denunciante"},{checked:!1,checkHandler:N,group:"filterField",key:"descripcion_anexos",scope:this,text:"Descripcion Anexos"},{checked:!1,checkHandler:N,group:"filterField",key:"gdoc",scope:this,text:"Gdoc"},{checked:!1,checkHandler:N,group:"filterField",key:"expediente",scope:this,text:"Expediente"},{checked:!1,checkHandler:N,group:"filterField",key:"recepcion_documento",scope:this,text:"Fecha"},{checked:!1,checkHandler:N,group:"filterField",key:"cedula",scope:this,text:"Cédula"},{checked:!1,checkHandler:N,group:"filterField",key:"guia",scope:this,text:"Guía"},{checked:!1,checkHandler:N,group:"filterField",key:"institucion",scope:this,text:"Institución"},{checked:!1,checkHandler:N,group:"filterField",key:"asunto",scope:this,text:"Asunto"}]}),text:"Trámite"}),P=new Ext.Button({menu:new Ext.menu.Menu({id:"tb_seleccionarUnidad1",disabled:!0,items:[{checked:!1,checkHandler:B,group:"targetField",key:"2",scope:this,text:"Secretaría"},{checked:!0,checkHandler:B,group:"targetField",key:"3",scope:this,text:"Inspeccion"},{checked:!1,checkHandler:B,group:"targetField",key:"4",scope:this,text:"Instrucción"},{checked:!1,checkHandler:B,group:"targetField",key:"5",scope:this,text:"Resolución y Ejecución"},{checked:!1,checkHandler:N,group:"filterField",key:"6",scope:this,text:"Administrativa y financiera"}]}),text:"Inspeccion"});this.targetFieldBtn=P,s=o.createWindow({id:"grid-win-denuncias",title:"Recepción Documentos",width:T,height:O,iconCls:"denuncias-icon",shim:!1,animCollapse:!1,constrainHeader:!0,layout:"fit",items:new Ext.TabPanel({activeTab:0,border:!1,id:"panelPrincipal",items:[{autoScroll:!0,title:"General",closable:!0,tbar:[{text:"Nuevo",scope:this,handler:this.adddenuncias,iconCls:"save-icon",disabled:!r},"-",{text:"Eliminar",scope:this,handler:this.deletedenuncias,iconCls:"delete-icon",disabled:!0},"-",{iconCls:"reload-icon",handler:this.requestGridData,scope:this,text:"Recargar",tooltip:"Recargar datos"},"-",{xtype:"checkbox",boxLabel:"No despachados ",id:"checkNoEnviados",name:"noenviados",checked:!1,inputValue:"1",tooltip:"Recargar datos",disabled:!r,cls:"barramenu",handler:function(e,t){Ext.getCmp("tb_repoteDenuncias").setDisabled(!this.checked),storeDenuncias.baseParams={noenviados:t},storeDenuncias.load(),Ext.getCmp("tb_seleccionarUnidad").setValue("Seleccionar Unidad")}},{xtype:"combo",fieldLabel:"Reasignado a",name:"tb_reasignacion",anchor:"95%",id:"tb_seleccionarUnidad",hiddenName:"tb_reasignacion",store:storeREATOT,valueField:"id",displayField:"nombre",typeAhead:!0,triggerAction:"all",mode:"local",width:250,value:"Seleccionar Unidad",listeners:{select:function(e){isChecked=Ext.getCmp("checkNoEnviados").getValue(),storeDenuncias.baseParams={noenviados:isChecked,unidadfiltro:e.value},storeDenuncias.load()}}},{iconCls:"excel-icon",handler:this.botonExportarReporte,scope:this,text:"Guía",tooltip:"Se genera el reporte de los items",id:"tb_repoteDenuncias",disabled:!0},"->",{text:"Buscar :",xtype:"tbtext"},L," "," ",new QoDesk.QoAdmin.SearchField({paramName:"filterText",store:this.storeDenuncias})],items:this.formDenunciasDetalle},{title:"Guías",closable:!0,layout:"border",tbar:[{iconCls:"reload-icon",handler:this.requestGridDataDenunciasGuia,scope:this,text:"Recargar Datos"},{iconCls:"excel-icon",handler:this.botonExportarReporteReimpresion,scope:this,text:"Generar Reporte",tooltip:"Se genera el reporte de la guía seleccionada",id:"tb_repoteDenunciasGuias",disabled:!r}],items:[{region:"north",height:200,minSize:100,maxSize:150,closable:!0,autoScroll:!1,items:this.gridDenunciasGuia},{region:"center",split:!0,autoScroll:!0,height:300,minSize:100,maxSize:150,margins:"0 0 0 0",items:this.gridDenunciasSimple}]},{title:"Reportes",closable:!0,layout:"border",tbar:[{iconCls:"reload-icon",handler:this.requestGridDataDocumentoReporte,scope:this,text:"Buscar"},{iconCls:"reload-icon",handler:this.requestGridDataDocumentoReporteReset,scope:this,text:"Borrar formulario"},{iconCls:"excel-icon",handler:this.botonExportarDocumentoReporte,scope:this,text:"Exportar listado",tooltip:"Se genera archivo Excel con la información solicitada",id:"tb_repoteDenunciasGuias"}],items:[{region:"north",height:145,minSize:100,maxSize:150,closable:!0,autoScroll:!1,items:this.formConsultaDocumentos},{region:"center",split:!0,autoScroll:!0,height:300,minSize:100,maxSize:150,items:this.gridDocumentosReporte}]},{autoScroll:!0,title:"Geolocalización",closable:!0,items:[{region:"center",xtype:"gmappanel",zoomLevel:12,gmapType:"map",id:"my_map",border:!1,fbar:[{text:"Confirmar dirección",handler:function(){Ext.getCmp("georeferenciaSecretaria").setValue(t),Ext.getCmp("panelPrincipal").setActiveTab(0)}}],mapConfOpts:["enableScrollWheelZoom","enableDoubleClickZoom","enableDragging"],mapControls:["GSmallMapControl","GMapTypeControl"],setCenter:{lat:-.1756096,lng:-78.4761627},markers:[{lat:-.17157021176359674,lng:-78.47847476417087,marker:{title:"Quito",draggable:!0},listeners:{click:function(e){},dragend:function(e){t=e.latLng.lat()+", "+e.latLng.lng()}}}]}]}]})})}function G(e,t,o){Ext.getCmp("formDenunciasDetalle").getForm().load({url:l+"crudDenuncias.php?operation=selectForm",params:{id:e},success:function(e,t){mensaje=Ext.getCmp("textRecepcionAnteriores"),"0"!=e.findField("totaldocumentos").getValue()?mensaje.setText("Total documentos anteriores: "+e.findField("totaldocumentos").getValue()):mensaje.setText("")}}),function(e,t){activar2=t||!i;r||(activar2=t=!0);Ext.getCmp("id_persona").setReadOnly(activar2),Ext.getCmp("recepcion_documento").setReadOnly(t),Ext.getCmp("id_tipo_documento").setReadOnly(t),Ext.getCmp("num_documento").setReadOnly(t),Ext.getCmp("remitente").setReadOnly(t),Ext.getCmp("cedula").setReadOnly(t),Ext.getCmp("email").setReadOnly(t),Ext.getCmp("descripcion_anexos").setReadOnly(t),Ext.getCmp("gdoc").setReadOnly(t),Ext.getCmp("expediente").setReadOnly(t),Ext.getCmp("cantidad_fojas").setReadOnly(t),Ext.getCmp("asunto").setReadOnly(t),Ext.getCmp("institucion").setReadOnly(t),Ext.getCmp("id_caracter_tramite").setReadOnly(t),Ext.getCmp("observacion_secretaria").setReadOnly(t),Ext.getCmp("despacho_secretaria").setReadOnly(!r),Ext.getCmp("guia").setReadOnly(!r),n?Ext.getCmp("reasignacion").disable():t?Ext.getCmp("reasignacion").disable():Ext.getCmp("reasignacion").enable()}(0,o)}s.show(),setTimeout(function(){this.storeDenuncias.load({params:{start:0,limit:limitedenuncias,noenviados:Ext.getCmp("checkNoEnviados").getValue()}})},500)},deletedenuncias:function(){Ext.Msg.show({title:"Confirmación",msg:"Está seguro de querer borrar?",scope:this,buttons:Ext.Msg.YESNO,fn:function(e){if("yes"==e){var t=this.gridDenuncias.getSelectionModel().getSelections();if(0===t.length)return!1;this.storeDenuncias.remove(t)}}})},adddenuncias:function(){var e=QoDesk.App.memberInfo.zonal,t=new this.storeDenuncias.recordType({codigo_tramite:" ",id_persona:" ",id_tipo:"",recepcion_documento:new Date,id_tipo_documento:"2",num_documento:"S/N",descripcion_anexos:"-",gdoc:"-",expediente:"-",institucion:"",remitente:"",reasignacion:"",asunto:"",id_caracter_tramite:"1",cantidad_fojas:"0",despacho_secretaria:!1,id_zonal_origen:e});this.gridDenuncias.stopEditing(),this.storeDenuncias.insert(0,t),this.gridDenuncias.startEditing(0,4)},requestGridData:function(){this.storeDenuncias.load({params:{noenviados:Ext.getCmp("checkNoEnviados").getValue()}})},botonExportarReporte:function(){"Seleccionar Unidad"==Ext.getCmp("tb_seleccionarUnidad").getValue()?Ext.Msg.show({title:"Advertencia",msg:"Seleccione unidad",scope:this,icon:Ext.Msg.WARNING}):Ext.Msg.show({title:"Advertencia",msg:"Se descarga el archivo Excel<br>Se cambia el estado de Enviado a Si.<br>¿Desea continuar?",scope:this,icon:Ext.Msg.WARNING,buttons:Ext.Msg.YESNO,fn:function(e){"yes"==e&&(window.location.href="modules/desktop/denuncias/server/descargaDenunciasNuevas.inc.php?unidad="+Ext.getCmp("tb_seleccionarUnidad").getValue(),setTimeout(function(){storeDenuncias.load({params:{noenviados:Ext.getCmp("checkNoEnviados").getValue()}})},1e3))}})},botonExportarReporteReimpresion:function(){var t=this.gridDenunciasGuia.getSelectionModel().getSelections();if(0===t.length)return Ext.Msg.show({title:"Atencion",msg:"Seleccione una guía a imprimir",scope:this,icon:Ext.Msg.WARNING}),!1;Ext.Msg.show({title:"Advertencia",msg:"Se descarga el archivo Excel<br>¿Desea continuar?",scope:this,icon:Ext.Msg.WARNING,buttons:Ext.Msg.YESNO,fn:function(e){"yes"==e&&(window.location.href="modules/desktop/denuncias/server/descargaDenunciasNuevas.inc.php?reimpresion=true&guia="+t[0].get("id"))}})},grabardenuncias:function(){Ext.Msg.show({title:"Advertencia",msg:"Desea Guardar los cambios.<br>¿Desea continuar?",scope:this,icon:Ext.Msg.WARNING,buttons:Ext.Msg.YESNO,fn:function(e){"yes"==e&&Ext.getCmp("formDenunciasDetalle").getForm().submit({url:"modules/desktop/denuncias/server/crudDenuncias.php?operation=updateForm",method:"POST",waitMsg:"Saving data",success:function(e,t){storeDenuncias.load({params:{noenviados:Ext.getCmp("checkNoEnviados").getValue()}}),Ext.getCmp("tb_grabardenuncias").setDisabled(!0)},failure:function(e,t){if(void 0!==t.response.responseText){var o=JSON.parse(t.response.responseText);Ext.Msg.show({title:"Error campos obligatorios",msg:o.msg,modal:!0,icon:Ext.Msg.ERROR,buttons:Ext.Msg.OK})}}})}})},showError:function(e,t){t=t||"Error",Ext.Msg.show({title:t,msg:e,modal:!0,icon:Ext.Msg.ERROR,buttons:Ext.Msg.OK})},requestGridDataDenunciasGuia:function(){this.storeDenunciasGuia.load()},requestGridDataDocumentoReporte:function(){this.storeDocumentosReporte.baseParams=this.formConsultaDocumentos.getForm().getValues(),this.storeDocumentosReporte.load()},requestGridDataDocumentoReporteReset:function(){this.formConsultaDocumentos.getForm().reset()},botonExportarDocumentoReporte:function(){if(0===this.storeDocumentosReporte.getCount())return Ext.Msg.show({title:"Atencion",msg:"Busqueda sin resultados",scope:this,icon:Ext.Msg.WARNING}),!1;Ext.Msg.show({title:"Advertencia",msg:"Se descarga el archivo Excel<br>¿Desea continuar?",scope:this,icon:Ext.Msg.WARNING,buttons:Ext.Msg.YESNO,fn:function(e){"yes"==e&&(valueParams=JSON.stringify(this.formConsultaDocumentos.getForm().getValues()),window.location.href="modules/desktop/denuncias/server/descargaReporte.inc.php?param="+valueParams)}})}});